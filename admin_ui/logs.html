<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>„É≠„Ç∞Èñ≤Ë¶ß - ACS FAQ Manager</title>
  <style>
    :root {
      --brand: #0066cc; --brand-dark: #004fa3; --brand-light: #e8f0fb;
      --bg: #f6f7fb; --white: #fff; --text: #111827; --text-muted: #6b7280;
      --border: #e5e7eb; --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Meiryo", sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; font-size: 14px; }
    header { background: #001529; color: #fff; padding: 0 24px; display: flex; justify-content: space-between; align-items: center; height: 56px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); gap: 12px; }
    .header-left { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
    .header-title { font-size: 16px; font-weight: 700; }
    nav { display: flex; gap: 4px; overflow-x: auto; }
    nav a { color: rgba(255,255,255,0.8); text-decoration: none; padding: 7px 12px; border-radius: 6px; font-size: 13px; white-space: nowrap; transition: all 0.2s; }
    nav a:hover, nav a.active { background: rgba(255,255,255,0.12); color: #fff; }
    .btn-logout { background: none; border: none; color: rgba(255,255,255,0.8); cursor: pointer; padding: 7px 12px; font-size: 13px; border-radius: 6px; font-family: inherit; white-space: nowrap; }
    .btn-logout:hover { background: rgba(255,255,255,0.1); color: #fff; }
    main { flex: 1; max-width: 1100px; margin: 0 auto; width: 100%; padding: 24px; }
    .toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
    .toolbar-title { font-size: 20px; font-weight: 700; flex: 1; }
    select { padding: 8px 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 13px; font-family: inherit; outline: none; background: #fff; }
    select:focus { border-color: var(--brand); }
    .btn { padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; border: none; font-family: inherit; transition: all 0.2s; }
    .btn-outline { background: #fff; border: 1.5px solid var(--border); color: var(--text); }
    .btn-outline:hover { border-color: var(--brand); color: var(--brand); }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .card { background: var(--white); border-radius: 12px; box-shadow: var(--shadow-sm); border: 1px solid var(--border); padding: 20px; }
    .card-title { font-size: 15px; font-weight: 700; margin-bottom: 14px; }
    .loading { text-align: center; padding: 30px; color: var(--text-muted); }
    .spinner { display: inline-block; width: 24px; height: 24px; border: 3px solid var(--border); border-top-color: var(--brand); border-radius: 50%; animation: spin 0.7s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    table { width: 100%; border-collapse: collapse; }
    th { padding: 9px 12px; text-align: left; font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; border-bottom: 1px solid var(--border); }
    td { padding: 9px 12px; border-bottom: 1px solid var(--border); font-size: 13px; }
    tr:last-child td { border-bottom: none; }
    .bar-wrap { display: flex; align-items: center; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border); }
    .bar-wrap:last-child { border-bottom: none; }
    .bar-label { flex: 1; font-size: 13px; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .bar-track { width: 120px; height: 8px; background: var(--border); border-radius: 4px; flex-shrink: 0; }
    .bar-fill { height: 100%; background: var(--brand); border-radius: 4px; }
    .bar-count { font-size: 12px; color: var(--text-muted); min-width: 32px; text-align: right; }
    footer { background: var(--white); border-top: 1px solid var(--border); padding: 16px 24px; text-align: center; color: var(--text-muted); font-size: 12px; }
    @media (max-width: 700px) { header { padding: 0 12px; } .header-title { display: none; } main { padding: 16px 12px; } .grid-2 { grid-template-columns: 1fr; } .bar-track { width: 80px; } }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <span style="font-size:20px;">üè¢</span>
      <span class="header-title">ACS FAQ Manager</span>
    </div>
    <nav>
      <a href="/admin/dashboard">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</a>
      <a href="/admin/videos">ÂãïÁîª„Éá„Éº„Çø</a>
      <a href="/admin/synonyms">ÂêåÁæ©Ë™û</a>
      <a href="/admin/faq">FAQÁ∑®ÈõÜ</a>
      <a href="/admin/logs" class="active">„É≠„Ç∞Èñ≤Ë¶ß</a>
    </nav>
    <button class="btn-logout" onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
  </header>

  <main>
    <div class="toolbar">
      <div class="toolbar-title">üìä „É≠„Ç∞Èñ≤Ë¶ß</div>
      <select id="monthSelect" onchange="loadSummary()">
        <option value="">Êúà„ÇíÈÅ∏Êäû...</option>
      </select>
      <a id="exportBtn" href="/admin/api/logs/export" class="btn btn-outline" style="text-decoration:none;">üì• CSVÂá∫Âäõ</a>
    </div>

    <div id="loadingArea" class="loading"><div class="spinner"></div></div>
    <div id="summaryArea" style="display:none;">
      <div class="grid-2">
        <div class="card">
          <div class="card-title">üìÖ Êó•Âà• Ê§úÁ¥¢Êï∞</div>
          <div id="dayTable"></div>
        </div>
        <div class="card">
          <div class="card-title">üîç ‰∫∫Ê∞ó„Ç≠„Éº„ÉØ„Éº„Éâ TOP50</div>
          <div id="queryChart"></div>
        </div>
      </div>
    </div>
    <div id="emptyArea" style="display:none;text-align:center;padding:60px;color:#6b7280;">Êúà„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
  </main>

  <footer>Copyright ¬© 2026 Toray Advanced Computer Solution, Inc.</footer>

  <script>
    var auth = localStorage.getItem('admin_auth');
    if (!auth) { window.location.href = '/admin'; }
    var authData = JSON.parse(auth);
    var authHeader = 'Basic ' + btoa(unescape(encodeURIComponent(authData.username + ':' + authData.password)));

    function logout() { localStorage.removeItem('admin_auth'); window.location.href = '/admin'; }

    function loadMonths() {
      fetch('/admin/api/logs/months', { headers: { 'Authorization': authHeader } })
        .then(function(r) { return r.json(); })
        .then(function(data) {
          var sel = document.getElementById('monthSelect');
          (data.months || []).forEach(function(m) {
            var opt = document.createElement('option');
            opt.value = m; opt.textContent = m;
            sel.appendChild(opt);
          });
          if (data.months && data.months.length > 0) {
            sel.value = data.months[0];
            loadSummary();
          } else {
            document.getElementById('loadingArea').style.display = 'none';
            document.getElementById('emptyArea').style.display = '';
          }
        })
        .catch(function() {
          document.getElementById('loadingArea').innerHTML = '<p style="color:#ef4444;">Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ</p>';
        });
    }

    function loadSummary() {
      var month = document.getElementById('monthSelect').value;
      if (!month) return;

      document.getElementById('loadingArea').style.display = '';
      document.getElementById('summaryArea').style.display = 'none';
      document.getElementById('emptyArea').style.display = 'none';

      fetch('/admin/api/logs/summary?month=' + encodeURIComponent(month), { headers: { 'Authorization': authHeader } })
        .then(function(r) { return r.json(); })
        .then(function(data) {
          renderDays(data.days || []);
          renderQueries(data.top_queries || []);
          document.getElementById('loadingArea').style.display = 'none';
          document.getElementById('summaryArea').style.display = '';
        });
    }

    function renderDays(days) {
      var el = document.getElementById('dayTable');
      if (days.length === 0) { el.innerHTML = '<p style="color:#6b7280;padding:16px;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>'; return; }
      var total = days.reduce(function(s, d) { return s + d.count; }, 0);
      var max = Math.max.apply(null, days.map(function(d) { return d.count; }));
      var html = '<table><thead><tr><th>Êó•‰ªò</th><th>‰ª∂Êï∞</th></tr></thead><tbody>';
      days.forEach(function(d) {
        html += '<tr><td>' + esc(d.day) + '</td><td><b>' + d.count + '</b></td></tr>';
      });
      html += '<tr><td><b>ÂêàË®à</b></td><td><b>' + total + '</b></td></tr>';
      html += '</tbody></table>';
      el.innerHTML = html;
    }

    function renderQueries(queries) {
      var el = document.getElementById('queryChart');
      if (queries.length === 0) { el.innerHTML = '<p style="color:#6b7280;padding:16px;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>'; return; }
      var max = queries[0].count;
      var html = '';
      queries.forEach(function(q) {
        var pct = max > 0 ? (q.count / max * 100) : 0;
        html +=
          '<div class="bar-wrap">' +
            '<div class="bar-label" title="' + esc(q.query) + '">' + esc(q.query) + '</div>' +
            '<div class="bar-track"><div class="bar-fill" style="width:' + pct.toFixed(1) + '%;"></div></div>' +
            '<div class="bar-count">' + q.count + '</div>' +
          '</div>';
      });
      el.innerHTML = html;
    }

    function esc(str) {
      return String(str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }

    loadMonths();
  </script>
</body>
</html>
