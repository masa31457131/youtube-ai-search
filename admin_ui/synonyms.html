<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åŒç¾©èªç·¨é›† - ACS FAQ Manager</title>
  <style>
    :root {
      --brand: #0066cc; --brand-dark: #004fa3; --brand-light: #e8f0fb;
      --bg: #f6f7fb; --white: #fff; --text: #111827; --text-muted: #6b7280;
      --border: #e5e7eb; --danger: #ef4444; --success: #10b981;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.08); --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Meiryo", sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; font-size: 14px; }
    header { background: #001529; color: #fff; padding: 0 24px; display: flex; justify-content: space-between; align-items: center; height: 56px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); gap: 12px; }
    .header-left { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
    .header-title { font-size: 16px; font-weight: 700; }
    nav { display: flex; gap: 4px; overflow-x: auto; }
    nav a { color: rgba(255,255,255,0.8); text-decoration: none; padding: 7px 12px; border-radius: 6px; font-size: 13px; white-space: nowrap; transition: all 0.2s; }
    nav a:hover, nav a.active { background: rgba(255,255,255,0.12); color: #fff; }
    .btn-logout { background: none; border: none; color: rgba(255,255,255,0.8); cursor: pointer; padding: 7px 12px; font-size: 13px; border-radius: 6px; font-family: inherit; white-space: nowrap; }
    .btn-logout:hover { background: rgba(255,255,255,0.1); color: #fff; }
    main { flex: 1; max-width: 1000px; margin: 0 auto; width: 100%; padding: 24px; }
    .toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
    .toolbar-title { font-size: 20px; font-weight: 700; flex: 1; }
    .btn { padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; border: none; font-family: inherit; transition: all 0.2s; }
    .btn-primary { background: var(--brand); color: #fff; }
    .btn-primary:hover { background: var(--brand-dark); }
    .btn-success { background: var(--success); color: #fff; }
    .btn-success:hover { opacity: 0.88; }
    .btn-outline { background: #fff; border: 1.5px solid var(--border); color: var(--text); }
    .btn-outline:hover { border-color: var(--brand); color: var(--brand); }
    .btn-sm { padding: 5px 10px; font-size: 12px; border-radius: 6px; }
    .btn-danger { background: var(--danger); color: #fff; }
    .card { background: var(--white); border-radius: 12px; box-shadow: var(--shadow-sm); border: 1px solid var(--border); }
    .synonym-list { list-style: none; }
    .synonym-item { display: flex; align-items: center; gap: 12px; padding: 14px 18px; border-bottom: 1px solid var(--border); }
    .synonym-item:last-child { border-bottom: none; }
    .synonym-term { font-weight: 700; min-width: 140px; color: var(--brand); }
    .synonym-values { flex: 1; display: flex; flex-wrap: wrap; gap: 6px; }
    .syn-tag { background: var(--brand-light); color: var(--brand); padding: 3px 10px; border-radius: 12px; font-size: 12px; }
    .action-btns { display: flex; gap: 6px; flex-shrink: 0; }
    .loading { text-align: center; padding: 40px; color: var(--text-muted); }
    .spinner { display: inline-block; width: 28px; height: 28px; border: 3px solid var(--border); border-top-color: var(--brand); border-radius: 50%; animation: spin 0.7s linear infinite; margin-right: 10px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: flex-start; justify-content: center; padding: 60px 16px; overflow-y: auto; backdrop-filter: blur(2px); }
    .modal-overlay.active { display: flex; }
    .modal-box { background: #fff; border-radius: 12px; width: 100%; max-width: 500px; margin: auto; box-shadow: var(--shadow-md); animation: modalIn 0.2s ease; }
    @keyframes modalIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    .modal-header { padding: 20px 24px 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .modal-title { font-size: 17px; font-weight: 700; }
    .modal-close { background: none; border: none; cursor: pointer; font-size: 20px; color: var(--text-muted); padding: 4px 8px; border-radius: 6px; }
    .modal-close:hover { background: var(--bg); }
    .modal-body { padding: 20px 24px; }
    .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; }
    .form-group { margin-bottom: 16px; }
    .form-label { display: block; margin-bottom: 5px; font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .form-input, .form-textarea { width: 100%; padding: 9px 12px; border: 1.5px solid var(--border); border-radius: 8px; font-size: 13px; font-family: inherit; outline: none; transition: border-color 0.2s; }
    .form-input:focus, .form-textarea:focus { border-color: var(--brand); }
    .form-textarea { resize: vertical; min-height: 80px; }
    .form-hint { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
    .toast { position: fixed; bottom: 24px; right: 24px; padding: 12px 20px; background: var(--text); color: #fff; border-radius: 8px; font-size: 13px; z-index: 9999; opacity: 0; transform: translateY(8px); transition: all 0.3s; }
    .toast.show { opacity: 1; transform: translateY(0); }
    .toast.success { background: var(--success); }
    .toast.error { background: var(--danger); }
    footer { background: var(--white); border-top: 1px solid var(--border); padding: 16px 24px; text-align: center; color: var(--text-muted); font-size: 12px; }
    @media (max-width: 600px) { header { padding: 0 12px; } .header-title { display: none; } main { padding: 16px 12px; } .synonym-item { flex-direction: column; align-items: flex-start; gap: 8px; } .synonym-term { min-width: unset; } }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <span style="font-size:20px;">ğŸ¢</span>
      <span class="header-title">ACS FAQ Manager</span>
    </div>
    <nav>
      <a href="/admin/dashboard">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
      <a href="/admin/videos">å‹•ç”»ãƒ‡ãƒ¼ã‚¿</a>
      <a href="/admin/synonyms" class="active">åŒç¾©èª</a>
      <a href="/admin/faq">FAQç·¨é›†</a>
      <a href="/admin/logs">ãƒ­ã‚°é–²è¦§</a>
    </nav>
    <button class="btn-logout" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </header>

  <main>
    <div class="toolbar">
      <div class="toolbar-title">ğŸ“š åŒç¾©èªç·¨é›†</div>
      <button class="btn btn-primary" onclick="openCreateModal()">ï¼‹ è¿½åŠ </button>
      <button class="btn btn-success" onclick="saveAll()">ğŸ’¾ ä¸€æ‹¬ä¿å­˜</button>
    </div>

    <div class="card">
      <div id="loadingArea" class="loading"><span class="spinner"></span> èª­ã¿è¾¼ã¿ä¸­...</div>
      <ul class="synonym-list" id="synonymList" style="display:none;"></ul>
    </div>
  </main>

  <!-- ç·¨é›†/ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-overlay" id="editModal">
    <div class="modal-box">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">åŒç¾©èªè¿½åŠ </div>
        <button class="modal-close" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">ä»£è¡¨èª</label>
          <input type="text" id="fieldTerm" class="form-input" placeholder="ä¾‹: PC" />
        </div>
        <div class="form-group">
          <label class="form-label">åŒç¾©èªï¼ˆ1è¡Œ1èªã¾ãŸã¯ ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
          <textarea id="fieldSyns" class="form-textarea" placeholder="ãƒ‘ã‚½ã‚³ãƒ³&#10;ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼&#10;ç«¯æœ«"></textarea>
          <div class="form-hint">1è¡Œ1èªã¾ãŸã¯ã€Œ, ã€åŒºåˆ‡ã‚Šã§å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn btn-primary" onclick="saveSynonym()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <footer>Copyright Â© 2026 Toray Advanced Computer Solution, Inc.</footer>

  <script>
    var auth = localStorage.getItem('admin_auth');
    if (!auth) { window.location.href = '/admin'; }
    var authData = JSON.parse(auth);
    var authHeader = 'Basic ' + btoa(unescape(encodeURIComponent(authData.username + ':' + authData.password)));

    var synonymData = {};
    var editingTerm = null;

    function logout() { localStorage.removeItem('admin_auth'); window.location.href = '/admin'; }

    function load() {
      fetch('/admin/api/synonyms', { headers: { 'Authorization': authHeader } })
        .then(function(r) { return r.json(); })
        .then(function(data) {
          synonymData = data || {};
          render();
          document.getElementById('loadingArea').style.display = 'none';
          document.getElementById('synonymList').style.display = '';
        })
        .catch(function() {
          document.getElementById('loadingArea').innerHTML = '<p style="color:#ef4444;padding:24px;">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
        });
    }

    function render() {
      var list = document.getElementById('synonymList');
      var terms = Object.keys(synonymData);
      if (terms.length === 0) {
        list.innerHTML = '<li style="padding:32px;text-align:center;color:#6b7280;">åŒç¾©èªãŒã‚ã‚Šã¾ã›ã‚“ã€‚</li>';
        return;
      }
      list.innerHTML = '';
      terms.forEach(function(term) {
        var syns = synonymData[term] || [];
        var li = document.createElement('li');
        li.className = 'synonym-item';
        var tags = syns.map(function(s) { return '<span class="syn-tag">' + esc(s) + '</span>'; }).join('');
        li.innerHTML =
          '<div class="synonym-term">' + esc(term) + '</div>' +
          '<div class="synonym-values">' + (tags || '<span style="color:#9ca3af;font-size:12px;">ï¼ˆãªã—ï¼‰</span>') + '</div>' +
          '<div class="action-btns">' +
            '<button class="btn btn-outline btn-sm" onclick="openEditModal(\'' + esc(term) + '\')">ç·¨é›†</button>' +
            '<button class="btn btn-danger btn-sm" onclick="deleteTerm(\'' + esc(term) + '\')">å‰Šé™¤</button>' +
          '</div>';
        list.appendChild(li);
      });
    }

    function openCreateModal() {
      editingTerm = null;
      document.getElementById('modalTitle').textContent = 'åŒç¾©èªè¿½åŠ ';
      document.getElementById('fieldTerm').value = '';
      document.getElementById('fieldTerm').disabled = false;
      document.getElementById('fieldSyns').value = '';
      document.getElementById('editModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function openEditModal(term) {
      editingTerm = term;
      document.getElementById('modalTitle').textContent = 'åŒç¾©èªç·¨é›†: ' + term;
      document.getElementById('fieldTerm').value = term;
      document.getElementById('fieldTerm').disabled = true;
      var syns = synonymData[term] || [];
      document.getElementById('fieldSyns').value = syns.join('\n');
      document.getElementById('editModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('editModal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function saveSynonym() {
      var term = document.getElementById('fieldTerm').value.trim();
      var synsRaw = document.getElementById('fieldSyns').value;
      var syns = synsRaw.split(/[\n,]/).map(function(s) { return s.trim(); }).filter(Boolean);
      if (!term) { showToast('ä»£è¡¨èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
      synonymData[term] = syns;
      closeModal();
      render();
      showToast('è¿½åŠ ã—ã¾ã—ãŸï¼ˆä¸€æ‹¬ä¿å­˜ãƒœã‚¿ãƒ³ã§ç¢ºå®šï¼‰', 'success');
    }

    function deleteTerm(term) {
      if (!confirm('ã€Œ' + term + 'ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
      delete synonymData[term];
      render();
      showToast('å‰Šé™¤ã—ã¾ã—ãŸï¼ˆä¸€æ‹¬ä¿å­˜ãƒœã‚¿ãƒ³ã§ç¢ºå®šï¼‰');
    }

    function saveAll() {
      fetch('/admin/api/synonyms', {
        method: 'PUT',
        headers: { 'Authorization': authHeader, 'Content-Type': 'application/json' },
        body: JSON.stringify(synonymData)
      })
      .then(function(r) {
        if (!r.ok) throw new Error();
        showToast('ä¿å­˜ã—ã¾ã—ãŸ', 'success');
      })
      .catch(function() { showToast('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error'); });
    }

    function showToast(msg, type) {
      var el = document.getElementById('toast');
      el.textContent = msg;
      el.className = 'toast show' + (type ? ' ' + type : '');
      setTimeout(function() { el.className = 'toast'; }, 3000);
    }

    function esc(str) {
      return String(str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }

    document.getElementById('editModal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
    document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeModal(); });

    load();
  </script>
</body>
</html>
