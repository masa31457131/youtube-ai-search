<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>サポート検索 | 東レACS</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; background: #f5f5f5; color: #333; line-height: 1.8; }
    header { background: #fff; border-bottom: 3px solid #0066cc; padding: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; }
    .logo { font-size: 24px; font-weight: bold; color: #0066cc; }
    .breadcrumb { color: #666; font-size: 14px; }
    .breadcrumb a { color: #0066cc; text-decoration: none; }
    .main-container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    .page-title { background: #fff; padding: 30px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .page-title h1 { color: #0066cc; font-size: 28px; margin-bottom: 10px; border-left: 4px solid #0066cc; padding-left: 15px; }
    .page-title p { color: #666; font-size: 14px; padding-left: 19px; }
    .search-section { background: #fff; padding: 30px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .search-box { position: relative; max-width: 800px; margin: 0 auto; }
    #searchInput { width: 100%; padding: 15px 120px 15px 20px; font-size: 16px; border: 2px solid #ddd; border-radius: 4px; outline: none; transition: border-color 0.3s; }
    #searchInput:focus { border-color: #0066cc; }
    #searchBtn { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: #0066cc; color: white; border: none; padding: 10px 30px; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background 0.3s; }
    #searchBtn:hover { background: #0052a3; }
    .section { background: #fff; padding: 30px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .section-header { border-bottom: 2px solid #0066cc; padding-bottom: 15px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
    .section-title { font-size: 20px; font-weight: bold; color: #333; display: flex; align-items: center; gap: 10px; }
    .section-title::before { content: ''; display: inline-block; width: 4px; height: 24px; background: #0066cc; }
    .result-count { color: #666; font-size: 14px; }
    .faq-item { padding: 20px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; transition: all 0.3s; cursor: pointer; background: #fafafa; }
    .faq-item:hover { border-color: #0066cc; background: #fff; box-shadow: 0 2px 8px rgba(0,102,204,0.1); }
    .faq-category { display: inline-block; background: #e3f2fd; color: #0066cc; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-bottom: 8px; }
    .faq-question { font-weight: bold; color: #0066cc; margin-bottom: 10px; font-size: 16px; }
    .faq-answer { color: #666; line-height: 1.8; font-size: 14px; white-space: pre-wrap; }
    .video-item { display: flex; gap: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 4px; transition: all 0.3s; cursor: pointer; background: #fafafa; }
    .video-item:hover { border-color: #0066cc; background: #fff; box-shadow: 0 2px 8px rgba(0,102,204,0.1); }
    .video-thumbnail { flex-shrink: 0; width: 200px; height: 112px; border-radius: 4px; overflow: hidden; background: #ddd; }
    .video-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
    .video-info { flex: 1; }
    .video-title { font-weight: bold; color: #0066cc; margin-bottom: 8px; font-size: 16px; }
    .video-description { color: #666; font-size: 14px; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .loading, .no-results { text-align: center; padding: 40px; font-size: 16px; }
    .loading { color: #0066cc; }
    .no-results { color: #999; }
    .hidden { display: none; }
    footer { background: #333; color: #fff; text-align: center; padding: 20px; margin-top: 60px; }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">東レACS</div>
      <div class="breadcrumb"><a href="https://www.toray-acs.co.jp/">ホーム</a> &gt; <a href="https://www.toray-acs.co.jp/support/">サポート</a> &gt; FAQ検索</div>
    </div>
  </header>
  <div class="main-container">
    <div class="page-title"><h1>サポート検索</h1><p>FAQ・マニュアル・動画から、お探しの情報を検索できます</p></div>
    <div class="search-section"><div class="search-box"><input type="text" id="searchInput" placeholder="キーワードを入力してください（例: ログイン方法、パスワードリセット）" autocomplete="off"><button id="searchBtn">検索</button></div></div>
    <div id="faqSection" class="section hidden"><div class="section-header"><div class="section-title">FAQ検索結果</div><div class="result-count" id="faqCount">0件</div></div><div id="faqResults"></div></div>
    <div id="videoSection" class="section hidden"><div class="section-header"><div class="section-title">動画検索結果</div><div class="result-count" id="videoCount">0件</div></div><div id="videoResults"></div></div>
    <div id="loading" class="loading hidden">検索中...</div>
    <div id="noResults" class="no-results hidden">検索結果が見つかりませんでした。<br>別のキーワードでお試しください。</div>
  </div>
  <footer><p>&copy; 2026 Toray Advanced Computer Solution, Inc. All rights reserved.</p></footer>
  <script>
    let synonymsData={},currentQuery='';
    async function loadSynonyms(){try{const r=await fetch('/api/synonyms');if(r.ok)synonymsData=await r.json()}catch(e){console.error(e)}}
    function expandQuery(q){const w=q.toLowerCase().split(/\s+/),e=new Set(w);for(const word of w){for(const[s,v]of Object.entries(synonymsData)){if(v.includes(word)){e.add(s);v.forEach(x=>e.add(x))}else if(s.toLowerCase()===word)v.forEach(x=>e.add(x))}}return[...e].join(' ')}
    async function performSearch(){const q=document.getElementById('searchInput').value.trim();if(!q)return;currentQuery=q;document.getElementById('loading').classList.remove('hidden');document.getElementById('faqSection').classList.add('hidden');document.getElementById('videoSection').classList.add('hidden');document.getElementById('noResults').classList.add('hidden');try{const eq=expandQuery(q),r=await fetch(`/api/search?q=${encodeURIComponent(eq)}`),d=await r.json();displayResults(d)}catch(e){document.getElementById('loading').classList.add('hidden');document.getElementById('noResults').classList.remove('hidden')}}
    function displayResults(d){document.getElementById('loading').classList.add('hidden');const faq=d.faq_results||[],vid=d.video_results||[];if(faq.length>0){document.getElementById('faqSection').classList.remove('hidden');document.getElementById('faqCount').textContent=faq.length+'件';document.getElementById('faqResults').innerHTML=faq.map(f=>`<div class="faq-item" onclick="onFaqClick('${f.id}')"><div class="faq-category">${escapeHtml(f.category)}</div><div class="faq-question">${escapeHtml(f.questions[0])}</div><div class="faq-answer">${escapeHtml(f.answer.substring(0,200))}...</div></div>`).join('')}if(vid.length>0){document.getElementById('videoSection').classList.remove('hidden');document.getElementById('videoCount').textContent=vid.length+'件';document.getElementById('videoResults').innerHTML=vid.map(v=>`<div class="video-item" onclick="onVideoClick('${v.video_id}')"><div class="video-thumbnail"><img src="${v.thumbnail}" alt="${escapeHtml(v.title)}"></div><div class="video-info"><div class="video-title">${escapeHtml(v.title)}</div><div class="video-description">${escapeHtml(v.description)}</div></div></div>`).join('')}if(!faq.length&&!vid.length)document.getElementById('noResults').classList.remove('hidden')}
    function onFaqClick(id){fetch('/api/log_search',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:currentQuery,result_type:'faq',result_id:id,timestamp:new Date().toISOString()})}).catch(e=>console.error(e))}
    function onVideoClick(id){fetch('/api/log_search',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:currentQuery,result_type:'video',result_id:id,timestamp:new Date().toISOString()})}).catch(e=>console.error(e));window.open('https://www.youtube.com/watch?v='+id,'_blank')}
    function escapeHtml(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}
    document.getElementById('searchBtn').addEventListener('click',performSearch);
    document.getElementById('searchInput').addEventListener('keypress',e=>{if(e.key==='Enter')performSearch()});
    loadSynonyms();
  </script>
</body>
</html>
