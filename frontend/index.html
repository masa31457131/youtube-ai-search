<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚µãƒãƒ¼ãƒˆæ¤œç´¢ | æ±ãƒ¬ACS</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Meiryo", "Yu Gothic", sans-serif;
      background: #f4f6f9; color: #333; line-height: 1.6;
      min-height: 100vh; display: flex; flex-direction: column;
    }

    /* â”€â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€â”€ */
    header {
      background: #fff; border-bottom: 3px solid #0066cc;
      padding: 1.2rem 2rem; box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    header h1 { font-size: 1.55rem; font-weight: 700; color: #0066cc; }
    header p  { font-size: 0.87rem; color: #666; margin-top: 0.15rem; }

    /* â”€â”€â”€ ãƒ¡ã‚¤ãƒ³ â”€â”€â”€ */
    main { flex: 1; max-width: 1200px; width: 100%; margin: 0 auto; padding: 2rem 1.5rem; }

    /* â”€â”€â”€ æ¤œç´¢ â”€â”€â”€ */
    .search-wrap { max-width: 680px; margin: 0 auto 2.5rem; }
    #searchInput {
      width: 100%; padding: 0.9rem 1.2rem; font-size: 1.05rem;
      border: 2px solid #ddd; border-radius: 8px;
      background: #fff; outline: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      transition: border-color 0.2s;
    }
    #searchInput:focus { border-color: #0066cc; }

    /* â”€â”€â”€ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€â”€ */
    .sec-head {
      display: flex; align-items: center; justify-content: space-between;
      margin: 2.2rem 0 1rem; padding-bottom: 0.6rem;
      border-bottom: 2px solid #0066cc;
    }
    .sec-title { font-size: 1.05rem; font-weight: 700; color: #0066cc; }
    .badge {
      font-size: 0.78rem; font-weight: 600; padding: 0.18rem 0.7rem;
      border-radius: 999px; background: #e3f2fd; color: #0066cc;
      border: 1px solid #90caf9;
    }

    /* â”€â”€â”€ FAQ ã‚°ãƒªãƒƒãƒ‰ï¼ˆ3åˆ— Ã— 3è¡Œ = 9ä»¶ï¼‰ â”€â”€â”€ */
    .faq-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem; margin-bottom: 0.5rem;
    }
    @media (max-width: 600px)  { .faq-grid { grid-template-columns: 1fr; } }
    @media (min-width: 601px) and (max-width: 900px) { .faq-grid { grid-template-columns: repeat(2, 1fr); } }

    .faq-card {
      background: #fff; border: 1px solid #e0e0e0; border-radius: 8px;
      padding: 0.85rem 1rem; cursor: pointer;
      display: flex; align-items: flex-start; gap: 0.55rem;
      transition: border-color 0.2s, box-shadow 0.2s, transform 0.15s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .faq-card:hover {
      border-color: #0066cc; transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,102,204,0.15);
    }
    .faq-q { color: #0066cc; font-weight: 700; font-size: 0.95rem; flex-shrink: 0; }
    .faq-text { font-size: 0.91rem; font-weight: 600; color: #1a1a1a; line-height: 1.45; }

    /* â”€â”€â”€ å‹•ç”»ã‚°ãƒªãƒƒãƒ‰ï¼ˆ3åˆ— Ã— 3è¡Œ = 9ä»¶ï¼‰ â”€â”€â”€ */
    .vid-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem; margin-bottom: 0.5rem;
    }
    @media (max-width: 600px)  { .vid-grid { grid-template-columns: 1fr; } }
    @media (min-width: 601px) and (max-width: 900px) { .vid-grid { grid-template-columns: repeat(2, 1fr); } }

    .vid-card {
      border-radius: 8px; overflow: hidden;
      cursor: pointer; position: relative;
      aspect-ratio: 16 / 9;
      border: 1px solid #e0e0e0; background: #111;
      transition: transform 0.15s, box-shadow 0.2s;
    }
    .vid-card:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.22); }
    .vid-card img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .vid-no-thumb {
      width: 100%; height: 100%; background: #ccc;
      display: flex; align-items: center; justify-content: center;
      color: #777; font-size: 0.85rem;
    }
    .vid-overlay {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: rgba(0,0,0,0); transition: background 0.2s;
    }
    .vid-card:hover .vid-overlay { background: rgba(0,0,0,0.38); }
    .play-btn {
      width: 48px; height: 48px; border-radius: 50%;
      background: rgba(255,255,255,0.92);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; transition: opacity 0.2s;
    }
    .vid-card:hover .play-btn { opacity: 1; }
    .play-btn::after {
      content: ""; margin-left: 4px;
      border-style: solid; border-width: 10px 0 10px 17px;
      border-color: transparent transparent transparent #0066cc;
    }

    /* â”€â”€â”€ ãƒšãƒ¼ã‚¸ãƒ£ãƒ¼ â”€â”€â”€ */
    .pager { display: flex; gap: 0.75rem; align-items: center; justify-content: center; margin: 1rem 0 1.5rem; }
    .pager button {
      padding: 0.45rem 1.1rem; border: 1px solid #ccc;
      background: #fff; border-radius: 6px; cursor: pointer;
      font-size: 0.88rem; color: #333; transition: background 0.15s, color 0.15s;
    }
    .pager button:hover:not([disabled]) { background: #0066cc; color: #fff; border-color: #0066cc; }
    .pager button[disabled] { opacity: 0.38; cursor: not-allowed; }
    .pager-info { color: #999; font-size: 0.88rem; min-width: 5rem; text-align: center; }

    /* â”€â”€â”€ çŠ¶æ…‹è¡¨ç¤º â”€â”€â”€ */
    .empty-wrap { text-align: center; padding: 4rem 2rem; }
    .empty-icon  { font-size: 3rem; margin-bottom: 0.75rem; }
    .empty-title { color: #555; font-size: 1.05rem; margin-bottom: 0.4rem; }
    .empty-sub   { color: #999; font-size: 0.9rem; }
    .loading     { text-align: center; padding: 4rem 2rem; }
    .spinner {
      width: 44px; height: 44px; margin: 0 auto 1rem;
      border: 4px solid #eee; border-top-color: #0066cc;
      border-radius: 50%; animation: spin 0.75s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€â”€ ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ â”€â”€â”€ */
    .lb-mask {
      display: none; position: fixed; inset: 0; z-index: 9000;
      background: rgba(0,0,0,0.76);
      align-items: center; justify-content: center;
    }
    .lb-mask.open { display: flex; }
    .lb-box {
      background: #fff; border-radius: 12px;
      width: 92%; max-width: 820px; max-height: 88vh;
      overflow-y: auto; position: relative; padding: 2rem;
      box-shadow: 0 24px 64px rgba(0,0,0,0.4);
    }
    .lb-close {
      position: absolute; top: 1rem; right: 1.25rem;
      font-size: 2rem; line-height: 1; cursor: pointer;
      color: #bbb; background: none; border: none;
      transition: color 0.2s;
    }
    .lb-close:hover { color: #333; }
    .lb-title {
      font-size: 1.2rem; font-weight: 700; color: #0066cc;
      border-bottom: 2px solid #e3f2fd;
      padding-bottom: 0.85rem; margin-bottom: 1.25rem;
      padding-right: 2.5rem; line-height: 1.5;
    }

    /* FAQ ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ */
    .lb-category {
      display: inline-block; background: #e3f2fd; color: #0066cc;
      padding: 0.18rem 0.75rem; border-radius: 999px;
      font-size: 0.82rem; font-weight: 600; margin-bottom: 1.1rem;
    }
    .lb-steps-title {
      font-size: 0.9rem; font-weight: 700; color: #444;
      margin-bottom: 0.6rem;
    }
    .lb-steps { list-style: none; padding: 0; }
    .lb-steps li {
      display: flex; gap: 0.75rem; align-items: flex-start;
      padding: 0.65rem 0.85rem; margin-bottom: 0.5rem;
      background: #f8faff; border-left: 3px solid #0066cc;
      border-radius: 0 6px 6px 0; font-size: 0.95rem; line-height: 1.6;
    }
    .lb-step-num {
      background: #0066cc; color: #fff;
      min-width: 22px; height: 22px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 700; flex-shrink: 0; margin-top: 2px;
    }
    .lb-keywords { margin-top: 1.25rem; padding-top: 1rem; border-top: 1px solid #eee; }
    .lb-kw-label { font-size: 0.82rem; color: #888; margin-bottom: 0.5rem; }
    .kw-tag {
      display: inline-block; background: #f5f5f5; color: #555;
      padding: 0.18rem 0.65rem; border-radius: 4px;
      font-size: 0.82rem; margin: 0.15rem 0.2rem;
      border: 1px solid #ddd;
    }
    .lb-no-steps {
      background: #fff8e1; border: 1px solid #ffe082; border-radius: 8px;
      padding: 1rem 1.25rem; color: #795548; font-size: 0.92rem;
    }

    /* å‹•ç”» ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ */
    .lb-video-wrap {
      position: relative; padding-top: 56.25%;
      margin-bottom: 1.25rem; border-radius: 8px; overflow: hidden;
    }
    .lb-video-wrap iframe { position: absolute; inset: 0; width: 100%; height: 100%; border: none; }
    .lb-no-video { color: #c00; margin-bottom: 1rem; font-size: 0.92rem; }
    .lb-yt-link { color: #0066cc; font-size: 0.95rem; }
    .lb-desc { color: #555; font-size: 0.9rem; white-space: pre-wrap; padding-top: 1rem; border-top: 1px solid #eee; }

    /* â”€â”€â”€ ãƒ•ãƒƒã‚¿ãƒ¼ â”€â”€â”€ */
    footer {
      background: #1a1a2e; color: #9ca3c0;
      text-align: center; padding: 1.1rem 1rem;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>

<header>
  <h1>ğŸ¢ æ±ãƒ¬ACS ã‚µãƒãƒ¼ãƒˆæ¤œç´¢</h1>
  <p>FAQãƒ»ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒ»å‹•ç”»ã‹ã‚‰ã€ãŠæ¢ã—ã®æƒ…å ±ã‚’æ¤œç´¢ã§ãã¾ã™</p>
</header>

<main>
  <div class="search-wrap">
    <input type="text" id="searchInput" placeholder="ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" autocomplete="off" />
  </div>
  <div id="resultsContainer"></div>
</main>

<!-- ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ -->
<div id="lb" class="lb-mask">
  <div class="lb-box">
    <button class="lb-close" onclick="closeLb()" aria-label="é–‰ã˜ã‚‹">&times;</button>
    <div id="lbTitle" class="lb-title"></div>
    <div id="lbBody"></div>
  </div>
</div>

<footer>
  <p>Copyright &copy; 2026 Toray Advanced Computer Solution, Inc.</p>
</footer>

<script>
/* ======================================================
   è¨­å®š
====================================================== */
var PAGE_SIZE = 9;    /* åˆæœŸè¡¨ç¤º9ä»¶ */
var DEBOUNCE  = 300;

/* ======================================================
   çŠ¶æ…‹
====================================================== */
var lastQuery  = "";
var faqOffset  = 0;
var vidOffset  = 0;
var faqHasMore = false;
var vidHasMore = false;
var faqItems   = [];
var vidItems   = [];
var synonyms   = {};
var timer      = null;

/* ======================================================
   ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
====================================================== */
function $(id){ return document.getElementById(id); }

function esc(s){
  var d = document.createElement("div");
  d.textContent = (s == null ? "" : String(s));
  return d.innerHTML;
}

/* URLã‹ã‚‰ YouTube video_id ã‚’æŠ½å‡º */
function getVideoId(item){
  var vid = String(item.video_id || "").trim();
  if(vid) return vid;
  var url = String(item.url || "");
  var m = url.match(/[?&]v=([A-Za-z0-9_-]{11})/);
  if(m) return m[1];
  m = url.match(/youtu\.be\/([A-Za-z0-9_-]{11})/);
  if(m) return m[1];
  return "";
}

/* ======================================================
   Synonymsï¼ˆåŒç¾©èªå±•é–‹ï¼‰
====================================================== */
function loadSynonyms(){
  fetch("/api/synonyms")
    .then(function(r){ return r.ok ? r.json() : {}; })
    .then(function(d){ synonyms = d || {}; })
    .catch(function(){});
}

function expandQuery(q){
  var words = q.toLowerCase().split(/\s+/);
  var set = {};
  for(var i = 0; i < words.length; i++) set[words[i]] = 1;
  for(var i = 0; i < words.length; i++){
    var w = words[i];
    for(var key in synonyms){
      var vars = synonyms[key];
      if(!Array.isArray(vars)) continue;
      var hit = false;
      for(var j = 0; j < vars.length; j++){
        if(String(vars[j] || "").toLowerCase() === w){ hit = true; break; }
      }
      if(hit){
        set[key] = 1;
        for(var j = 0; j < vars.length; j++) set[vars[j]] = 1;
      } else if(key.toLowerCase() === w){
        for(var j = 0; j < vars.length; j++) set[vars[j]] = 1;
      }
    }
  }
  var arr = [];
  for(var k in set) arr.push(k);
  return arr.join(" ");
}

/* ======================================================
   ã‚¯ãƒªãƒƒã‚¯ãƒ­ã‚°
====================================================== */
function sendLog(type, id){
  fetch("/api/log_search", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      query: lastQuery, result_type: type,
      result_id: String(id || ""), timestamp: new Date().toISOString()
    })
  }).catch(function(){});
}

/* ======================================================
   API ãƒ•ã‚§ãƒƒãƒ
====================================================== */
function apiFetch(path){
  return fetch(path).then(function(r){
    if(!r.ok) throw new Error("HTTP " + r.status + " / " + path);
    return r.json();
  });
}

function loadFAQ(){
  var q = expandQuery(lastQuery);
  var p = new URLSearchParams({ query: q, offset: faqOffset, limit: PAGE_SIZE, paged: 1 });
  return apiFetch("/faq/search?" + p.toString());
}

function loadVideos(){
  var q = expandQuery(lastQuery);
  var p = new URLSearchParams({ query: q, offset: vidOffset, limit: PAGE_SIZE, paged: 1 });
  return apiFetch("/search?" + p.toString());
}

/* ======================================================
   ã‚«ãƒ¼ãƒ‰æç”»
====================================================== */
function renderFAQ(items){
  if(!items || !items.length)
    return '<p style="color:#999;padding:0.75rem 0;">FAQãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
  var html = '<div class="faq-grid">';
  for(var i = 0; i < items.length; i++){
    var q = items[i].question || (items[i].utterances && items[i].utterances[0]) || "ï¼ˆè³ªå•ãªã—ï¼‰";
    html += '<div class="faq-card" data-type="faq" data-index="' + i + '">'
          + '<span class="faq-q">Q</span>'
          + '<span class="faq-text">' + esc(q) + '</span>'
          + '</div>';
  }
  return html + '</div>';
}

function renderVideos(items){
  if(!items || !items.length)
    return '<p style="color:#999;padding:0.75rem 0;">å‹•ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
  var html = '<div class="vid-grid">';
  for(var i = 0; i < items.length; i++){
    var v     = items[i];
    var thumb = v.thumbnail || "";
    var title = esc(v.title || "");
    html += '<div class="vid-card" data-type="video" data-index="' + i + '" title="' + title + '">';
    if(thumb){
      html += '<img src="' + esc(thumb) + '" alt="' + title + '" loading="lazy">';
    } else {
      html += '<div class="vid-no-thumb">å‹•ç”»</div>';
    }
    html += '<div class="vid-overlay"><div class="play-btn"></div></div>';
    html += '</div>';
  }
  return html + '</div>';
}

function renderPager(type, hasMore, offset, count){
  var pid = type === "faq" ? "faqPrev" : "vidPrev";
  var nid = type === "faq" ? "faqNext" : "vidNext";
  var pd  = (offset <= 0) ? "disabled" : "";
  var nd  = !hasMore      ? "disabled" : "";
  var info = count > 0 ? (offset + 1) + "â€“" + (offset + count) + "ä»¶" : "0ä»¶";
  return '<div class="pager">'
       + '<button id="' + pid + '" ' + pd + '>â† å‰ã® ' + PAGE_SIZE + ' ä»¶</button>'
       + '<span class="pager-info">' + info + '</span>'
       + '<button id="' + nid + '" ' + nd + '>æ¬¡ã® ' + PAGE_SIZE + ' ä»¶ â†’</button>'
       + '</div>';
}

/* ======================================================
   æ¤œç´¢å®Ÿè¡Œ
====================================================== */
function renderResults(){
  var c = $("resultsContainer");
  if(!lastQuery.trim()){
    c.innerHTML = '<div class="empty-wrap">'
                + '<div class="empty-icon">ğŸ”</div>'
                + '<div class="empty-title">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦æ¤œç´¢</div>'
                + '<div class="empty-sub">å‹•ç”»ã¨FAQã‹ã‚‰æœ€é©ãªæƒ…å ±ã‚’è¦‹ã¤ã‘ã¾ã™</div>'
                + '</div>';
    return;
  }
  c.innerHTML = '<div class="loading"><div class="spinner"></div><p style="color:#888;">æ¤œç´¢ä¸­...</p></div>';

  Promise.all([loadFAQ(), loadVideos()])
    .then(function(res){
      var fd = res[0];
      var vd = res[1];
      faqHasMore = fd.has_more || false;
      vidHasMore = vd.has_more || false;
      faqItems   = fd.items    || [];
      vidItems   = vd.items    || [];

      var html = "";

      /* FAQ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
      html += '<div class="sec-head">'
            + '<span class="sec-title">FAQå€™è£œ</span>'
            + '<span class="badge">' + (fd.total_visible || 0) + 'ä»¶</span>'
            + '</div>';
      html += renderFAQ(faqItems);
      html += renderPager("faq", faqHasMore, faqOffset, faqItems.length);

      /* å‹•ç”»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
      html += '<div class="sec-head">'
            + '<span class="sec-title">é–¢é€£å‹•ç”»</span>'
            + '<span class="badge">' + (vd.total_visible || 0) + 'ä»¶</span>'
            + '</div>';
      html += renderVideos(vidItems);
      html += renderPager("video", vidHasMore, vidOffset, vidItems.length);

      c.innerHTML = html;
      bindCards();
      bindPager();
    })
    .catch(function(e){
      c.innerHTML = '<div class="empty-wrap"><div class="empty-sub">ã‚¨ãƒ©ãƒ¼: ' + esc(e.message) + '</div></div>';
    });
}

/* ======================================================
   ã‚«ãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
====================================================== */
function bindCards(){
  var cards = document.querySelectorAll("[data-type]");
  for(var i = 0; i < cards.length; i++){
    (function(card){
      card.addEventListener("click", function(){
        var type  = card.getAttribute("data-type");
        var index = parseInt(card.getAttribute("data-index"), 10);
        if(type === "faq"   && faqItems[index]) openFaqLb(faqItems[index]);
        if(type === "video" && vidItems[index]) openVideoLb(vidItems[index]);
      });
    })(cards[i]);
  }
}

/* ======================================================
   FAQ ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹
   ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: question / utterances / steps / keywords / category / intent
====================================================== */
function openFaqLb(item){
  var question = item.question
              || (item.utterances && item.utterances[0])
              || "(è³ªå•ãªã—)";
  var category = item.category || "";
  var steps    = item.steps    || [];
  var keywords = item.keywords || [];

  sendLog("faq", item.id || item.intent || "");

  /* ã‚¿ã‚¤ãƒˆãƒ« */
  $("lbTitle").textContent = question;

  var body = "";

  /* ã‚«ãƒ†ã‚´ãƒªãƒãƒƒã‚¸ */
  if(category){
    body += '<div class="lb-category">ğŸ“‚ ' + esc(category) + '</div>';
  }

  /* æ‰‹é †ï¼ˆstepsï¼‰ãŒå›ç­”æœ¬ä½“ */
  if(steps.length){
    body += '<div class="lb-steps-title">âœ… æ‰‹é †ãƒ»å›ç­”</div>';
    body += '<ol class="lb-steps">';
    for(var i = 0; i < steps.length; i++){
      body += '<li>'
            + '<span class="lb-step-num">' + (i + 1) + '</span>'
            + '<span>' + esc(steps[i]) + '</span>'
            + '</li>';
    }
    body += '</ol>';
  } else {
    body += '<div class="lb-no-steps">å›ç­”æ‰‹é †ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>';
  }

  /* ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ */
  if(keywords.length){
    body += '<div class="lb-keywords">'
          + '<div class="lb-kw-label">ğŸ”‘ é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</div>';
    for(var i = 0; i < keywords.length; i++){
      body += '<span class="kw-tag">' + esc(keywords[i]) + '</span>';
    }
    body += '</div>';
  }

  $("lbBody").innerHTML = body;
  openLb();
}

/* ======================================================
   å‹•ç”» ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹
====================================================== */
function openVideoLb(item){
  var vid   = getVideoId(item);
  var title = item.title       || "";
  var desc  = item.description || "";

  sendLog("video", vid || "");

  $("lbTitle").textContent = title;

  var body = "";

  if(vid){
    var src = "https://www.youtube.com/embed/" + vid
            + "?autoplay=1&rel=0&modestbranding=1";
    body += '<div class="lb-video-wrap">'
          + '<iframe src="' + src + '"'
          + ' allow="autoplay; encrypted-media; fullscreen; picture-in-picture"'
          + ' allowfullscreen loading="lazy"></iframe>'
          + '</div>';
  } else {
    body += '<p class="lb-no-video">âš ï¸ å‹•ç”»IDãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
    if(item.url){
      body += '<p><a class="lb-yt-link" href="' + esc(item.url) + '"'
            + ' target="_blank" rel="noopener">â–¶ YouTubeã§é–‹ã</a></p>';
    }
  }

  if(desc.trim()){
    body += '<div class="lb-desc">' + esc(desc) + '</div>';
  }

  $("lbBody").innerHTML = body;
  openLb();
}

/* ======================================================
   ãƒ©ã‚¤ãƒˆãƒœãƒƒã‚¯ã‚¹ é–‹é–‰
====================================================== */
function openLb(){
  $("lb").classList.add("open");
  document.body.style.overflow = "hidden";
}

function closeLb(){
  var iframe = $("lb").querySelector("iframe");
  if(iframe) iframe.src = "";          /* å‹•ç”»åœæ­¢ */
  $("lb").classList.remove("open");
  document.body.style.overflow = "";
  $("lbBody").innerHTML = "";
}

$("lb").addEventListener("click", function(e){
  if(e.target === $("lb")) closeLb();
});

document.addEventListener("keydown", function(e){
  if(e.key === "Escape") closeLb();
});

/* ======================================================
   ãƒšãƒ¼ã‚¸ãƒ£ãƒ¼
====================================================== */
function bindPager(){
  function on(id, fn){ var el = $(id); if(el) el.addEventListener("click", fn); }
  on("faqPrev", function(){ faqOffset = Math.max(0, faqOffset - PAGE_SIZE); renderResults(); });
  on("faqNext", function(){ faqOffset += PAGE_SIZE; renderResults(); });
  on("vidPrev", function(){ vidOffset = Math.max(0, vidOffset - PAGE_SIZE); renderResults(); });
  on("vidNext", function(){ vidOffset += PAGE_SIZE; renderResults(); });
}

/* ======================================================
   å…¥åŠ›
====================================================== */
function doSearch(q){
  lastQuery = q; faqOffset = 0; vidOffset = 0;
  renderResults();
}

$("searchInput").addEventListener("input", function(e){
  clearTimeout(timer);
  var q = e.target.value;
  timer = setTimeout(function(){ doSearch(q); }, DEBOUNCE);
});

$("searchInput").addEventListener("keydown", function(e){
  if(e.key === "Enter"){ clearTimeout(timer); doSearch(e.target.value); }
});

/* ======================================================
   åˆæœŸåŒ–
====================================================== */
loadSynonyms();
renderResults();
</script>
</body>
</html>
